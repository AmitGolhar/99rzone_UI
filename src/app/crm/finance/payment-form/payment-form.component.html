<div class="card shadow-sm p-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="text-primary mb-0">
      {{ isEditMode ? '✏️ Edit Payment Record' : '➕ Add Payment Record' }}
    </h5>

    <a routerLink="/crm/payments" class="btn btn-sm btn-outline-secondary">
      ← Back to List
    </a>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="text-center my-4">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-2 text-muted">Processing, please wait...</p>
  </div>

  <!-- Form Section -->
  <form *ngIf="!loading" (ngSubmit)="save()" #paymentForm="ngForm" novalidate>
    <div class="row g-3">

      <div class="col-md-6">
        <label class="form-label fw-semibold">Client Name <span class="text-danger">*</span></label>
        <input
          class="form-control"
          [(ngModel)]="payment.clientName"
          name="clientName"
          required
          placeholder="Enter client name"
        />
        <div *ngIf="paymentForm.submitted && !payment.clientName" class="text-danger small mt-1">
          Client name is required.
        </div>
      </div>

      <div class="col-md-6">
        <label class="form-label fw-semibold">Property</label>
        <input
          class="form-control"
          [(ngModel)]="payment.propertyName"
          name="propertyName"
          placeholder="Enter property name"
        />
      </div>

      <div class="col-md-4">
        <label class="form-label fw-semibold">Total Amount <span class="text-danger">*</span></label>
        <input
          type="number"
          class="form-control"
          [(ngModel)]="payment.totalAmount"
          name="totalAmount"
          (input)="calculatePending()"
          required
          placeholder="e.g. 1200000"
        />
        <div *ngIf="paymentForm.submitted && !payment.totalAmount" class="text-danger small mt-1">
          Total amount is required.
        </div>
      </div>

      <div class="col-md-4">
        <label class="form-label fw-semibold">Paid Amount</label>
        <input
          type="number"
          class="form-control"
          [(ngModel)]="payment.paidAmount"
          name="paidAmount"
          (input)="calculatePending()"
          placeholder="e.g. 800000"
        />
      </div>

      <div class="col-md-4">
        <label class="form-label fw-semibold">Pending Amount</label>
        <input
          type="number"
          class="form-control bg-light"
          [(ngModel)]="payment.pendingAmount"
          name="pendingAmount"
          readonly
        />
      </div>

      <div class="col-md-4">
        <label class="form-label fw-semibold">Status</label>
        <input
          class="form-control bg-light"
          [(ngModel)]="payment.status"
          name="status"
          readonly
        />
      </div>

      <div class="col-md-4">
        <label class="form-label fw-semibold">Next Due Date</label>
        <input
          type="date"
          class="form-control"
          [(ngModel)]="payment.nextDueDate"
          name="nextDueDate"
        />
      </div>

      <div class="col-md-4">
        <label class="form-label fw-semibold">Payment Mode</label>
        <select
          class="form-select"
          [(ngModel)]="payment.paymentMode"
          name="paymentMode"
        >
          <option value="">Select</option>
          <option>Cash</option>
          <option>Cheque</option>
          <option>Bank Transfer</option>
          <option>UPI</option>
        </select>
      </div>

      <div class="col-md-6">
        <label class="form-label fw-semibold">Client Phone</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="payment.clientPhone"
          name="clientPhone"
          maxlength="10"
          placeholder="e.g. 9876543210"
        />
      </div>

      <div class="col-md-6">
        <label class="form-label fw-semibold">Payment Date</label>
        <input
          type="date"
          class="form-control"
          [(ngModel)]="payment.paymentDate"
          name="paymentDate"
        />
      </div>

      <div class="col-12">
        <label class="form-label fw-semibold">Notes</label>
        <textarea
          class="form-control"
          rows="2"
          [(ngModel)]="payment.notes"
          name="notes"
          placeholder="Add any relevant notes here..."
        ></textarea>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="mt-4 d-flex justify-content-end">
      <button class="btn btn-primary px-4">
        {{ isEditMode ? '💾 Update Payment' : '💰 Save Payment' }}
      </button>
      <a routerLink="/crm/payments" class="btn btn-outline-secondary ms-2 px-4">
        Cancel
      </a>
    </div>
  </form>
</div>

<!-- 🔹 Toast Notification -->
<div
  class="toast-container position-fixed bottom-0 end-0 p-3"
  style="z-index: 1200;"
>
  <div
    id="toastMessage"
    class="toast align-items-center text-white bg-dark border-0"
    role="alert"
    aria-live="assertive"
    aria-atomic="true"
  >
    <div class="d-flex">
      <div class="toast-body">Message</div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        data-bs-dismiss="toast"
        aria-label="Close"
      ></button>
    </div>
  </div>
</div>
