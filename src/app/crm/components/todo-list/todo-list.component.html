<!-- üü¶ Header -->
<div class="todo-header mb-3 d-flex justify-content-between align-items-center">
  <h5 class="text-primary mb-0">üóÇ To-Do Task Board</h5>
  <button class="btn btn-success btn-sm" (click)="add()">‚ûï Add Task</button>
</div>

<!-- üü© Kanban Board -->
<div class="kanban d-flex gap-3 overflow-auto pb-3">
  <div *ngFor="let col of columns" class="kanban-column card p-2 shadow-sm border-0" style="min-width: 300px;">
    <div class="fw-bold mb-2 text-center bg-light rounded py-1">
      {{ col.status }} <small class="text-muted">({{ col.tasks.length }})</small>
    </div>

    <!-- Drop Zone -->
    <div
      cdkDropList
      #list="cdkDropList"
      [cdkDropListData]="col.tasks"
      [cdkDropListConnectedTo]="dropLists"
      class="kanban-list p-1"
      (cdkDropListDropped)="drop($event, col.status)"
    >
      <!-- Task Card -->
      <div
        *ngFor="let t of col.tasks"
        cdkDrag
        class="kanban-card card mb-2 p-2 border-start border-3"
        [ngClass]="{
          'border-danger': isOverdue(t),
          'border-success': t.status === 'Completed',
          'border-warning': t.status === 'In Progress'
        }"
      >
        <div class="fw-semibold">{{ t.title }}</div>
        <div><small>{{ t.moduleType }} ‚Ä¢ {{ t.priority }}</small></div>
        <div><small>üë§ {{ t.assignedTo || '-' }}</small></div>
        <div><small>üìÖ {{ t.dueDate || '-' }}</small></div>

        <div class="mt-2 d-flex gap-1">
          <button class="btn btn-sm btn-outline-primary" (click)="edit(t)">‚úèÔ∏è</button>
          <button class="btn btn-sm btn-outline-danger" (click)="delete(t)">üóëÔ∏è</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- üü® Add/Edit Modal Form -->
<div *ngIf="editing" class="modal fade show d-block" style="background: rgba(0,0,0,.5);">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content p-3 shadow">
      <div class="modal-header border-0">
        <h5 class="modal-title mb-0">
          {{ editing.id ? '‚úèÔ∏è Edit Task' : '‚ûï New Task' }}
        </h5>
        <button type="button" class="btn-close" (click)="closeForm()"></button>
      </div>

      <form (ngSubmit)="save(editing)">
        <div class="row g-3">
          <div class="col-md-6">
            <label>Title</label>
            <input class="form-control" [(ngModel)]="editing.title" name="title" required />
          </div>

          <div class="col-md-6">
            <label>Assigned To</label>
            <input class="form-control" [(ngModel)]="editing.assignedTo" name="assignedTo" />
          </div>

          <div class="col-md-4">
            <label>Module</label>
            <select class="form-select" [(ngModel)]="editing.moduleType" name="moduleType">
              <option>RENT</option>
              <option>RESELL</option>
              <option>PAYMENT</option>
              <option>LEGAL</option>
              <option>MARKETING</option>
              <option>CLIENT_INTERACTION</option>
              <option>ADMIN</option>
              <option>AFTER_SALES</option>
              <option>OTHER</option>
            </select>
          </div>

          <div class="col-md-4">
            <label>Priority</label>
            <select class="form-select" [(ngModel)]="editing.priority" name="priority">
              <option>Low</option>
              <option>Medium</option>
              <option>High</option>
              <option>Critical</option>
            </select>
          </div>

          <div class="col-md-4">
            <label>Status</label>
            <select class="form-select" [(ngModel)]="editing.status" name="status">
              <option>Pending</option>
              <option>In Progress</option>
              <option>On Hold</option>
              <option>Completed</option>
              <option>Cancelled</option>
            </select>
          </div>

          <div class="col-md-6">
            <label>Due Date</label>
            <input type="date" class="form-control" [(ngModel)]="editing.dueDate" name="dueDate" />
          </div>

          <div class="col-md-6">
            <label>Reminder Date</label>
            <input type="date" class="form-control" [(ngModel)]="editing.reminderDate" name="reminderDate" />
          </div>

          <div class="col-12">
            <label>Description</label>
            <textarea
              class="form-control"
              rows="2"
              [(ngModel)]="editing.description"
              name="description"
            ></textarea>
          </div>

          <div class="col-12">
            <label>Notes</label>
            <textarea
              class="form-control"
              rows="2"
              [(ngModel)]="editing.notes"
              name="notes"
            ></textarea>
          </div>
        </div>

        <div class="mt-3 d-flex justify-content-end gap-2">
          <button class="btn btn-primary" type="submit">üíæ Save</button>
          <button type="button" class="btn btn-secondary" (click)="closeForm()">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>
